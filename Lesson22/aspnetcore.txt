Используйте app.Run, если вам нужно завершить обработку запроса (например, для обработки ошибок).
Используйте app.Use, чтобы добавить Middleware, которое передает запрос следующему Middleware.
Используйте app.Map, чтобы настроить Middleware для определенных путей.


AddTransient():
Создает временный сервис.
Каждый раз, когда сервис запрашивается, создается новый экземпляр.
Подходит для коротких задач, где требуется новый объект при каждом запросе.
Пример использования: логирование, временные операции.

AddScoped():
Создает облачный сервис.
В рамках одного HTTP-запроса используется один экземпляр сервиса.
При следующем HTTP-запросе создается новый экземпляр.
Подходит для задач, связанных с обработкой одного запроса (например, обработка данных пользователя).

AddSingleton():
Создает одиночный сервис.
Экземпляр создается при первом запросе (или при запуске ConfigureServices), и затем он используется для всех последующих запросов.
Подходит для общих, долгосрочных задач, где требуется один и тот же объект для всех клиентов.